name: Monday Morning Investment Motivation

on:
  schedule:
    # æ¯é€±æœˆæ›œæ—¥ JST 6:00 (UTC 21:00 on Sunday) ã«å®Ÿè¡Œ
    - cron: '0 21 * * 0'
  workflow_dispatch:  # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

permissions:
  contents: read

jobs:
  send-motivation:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests

      - name: Send motivation message to Discord
        run: |
          python -c "
          import requests
          import json
          from datetime import datetime

          webhook_url = '${{ secrets.DISCORD_WEBHOOK_URL }}'

          description = (
              '**ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ï¼æ–°ã—ã„é€±ã®ã‚¹ã‚¿ãƒ¼ãƒˆã§ã™ï¼**\n\n'
              'ä»Šé€±ã¯æœ‰æœ›ãªéŠ˜æŸ„ã‚’è¦‹ã¤ã‘ã¦ã€ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã‚’æ§‹ç¯‰ã—ã¦ã„ãé€±ã§ã™ã€‚\n'
              'åˆå‰ä¸­ã«ä»¥ä¸‹ã®ã“ã¨ã‚’ã—ã¾ã—ã‚‡ã†ï¼š\n\n'
              'âœ… **é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆã‚’ç¢ºèª**\n'
              '   - æ¨å¥¨éŠ˜æŸ„ã®é¸å®šãƒã‚¤ãƒ³ãƒˆã‚’ç†è§£ã™ã‚‹\n'
              '   - å„ä¼æ¥­ã®æ‡¸å¿µç‚¹ã‚’ã—ã£ã‹ã‚ŠæŠŠæ¡ã™ã‚‹\n'
              '   - æ¨å¥¨ã•ã‚Œã‚‹è²·ã„æ–¹ã®ç†ç”±ã‚’è€ƒãˆã‚‹\n\n'
              'âœ… **å¸‚å ´ã®å‹•å‘ã‚’ãƒã‚§ãƒƒã‚¯**\n'
              '   - å…ˆé€±æœ«ã‹ã‚‰ã®ä¸»è¦ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’ç¢ºèª\n'
              '   - æ³¨ç›®ã—ã¦ã„ã‚‹éŠ˜æŸ„ã®å€¤å‹•ãã‚’ãƒã‚§ãƒƒã‚¯\n\n'
              'âœ… **è‡ªåˆ†ãªã‚Šã®æŠ•è³‡åˆ¤æ–­ã‚’**\n'
              '   - ãƒ¬ãƒãƒ¼ãƒˆã‚’å‚è€ƒã«ã€è‡ªåˆ†ã§è€ƒãˆã¦åˆ¤æ–­ã™ã‚‹\n'
              '   - ãªãœãã®éŠ˜æŸ„ã‚’è²·ã†ã®ã‹ã€ç†ç”±ã‚’æ˜ç¢ºã«ã™ã‚‹\n'
              '   - è²·ã„ä»˜ã‘ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¨é‡‘é¡ã‚’è¨ˆç”»ã™ã‚‹\n\n'
              '**ğŸ’¡ ä»Šé€±ã®æŠ•è³‡æ ¼è¨€**\n'
              'ã€ŒæŠ•è³‡ã§ä¸€ç•ªå¤§åˆ‡ãªã®ã¯ã€è‡ªåˆ†ã§è€ƒãˆã‚‹ã“ã¨ã ã€\n'
              'â€” ã‚¦ã‚©ãƒ¼ãƒ¬ãƒ³ãƒ»ãƒãƒ•ã‚§ãƒƒãƒˆï¼ˆãƒãƒ¼ã‚¯ã‚·ãƒ£ãƒ¼ãƒ»ãƒã‚µã‚¦ã‚§ã‚¤ä¼šé•·å…¼CEOï¼‰\n\n'
              'ä»Šé€±ã‚‚ãƒ¬ãƒãƒ¼ãƒˆã‚’æ´»ç”¨ã—ãªãŒã‚‰ã€æŠ•è³‡ã‚¹ã‚­ãƒ«ã‚’ç£¨ã„ã¦ã„ãã¾ã—ã‚‡ã†ï¼\n'
              'é ‘å¼µã£ã¦ãã ã•ã„ï¼ ğŸ’ª'
          )

          embed = {
            'embeds': [{
              'title': 'ğŸ“ˆ æœˆæ›œæ—¥ã®æœã§ã™ï¼ä»Šé€±ã‚‚æŠ•è³‡ã§æˆåŠŸã‚’æ´ã¿ã¾ã—ã‚‡ã†ï¼',
              'description': description,
              'color': 3447003,
              'thumbnail': {
                'url': 'https://raw.githubusercontent.com/microsoft/fluentui-emoji/main/assets/Chart%20increasing/Color/chart_increasing_color.svg'
              },
              'footer': {
                'text': 'ä»Šé€±ã‚‚è³¢ã„æŠ•è³‡åˆ¤æ–­ã‚’ï¼'
              },
              'timestamp': datetime.utcnow().isoformat()
            }]
          }

          response = requests.post(webhook_url, json=embed)

          if response.status_code == 204:
            print('âœ“ ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’Discordã«é€ä¿¡ã—ã¾ã—ãŸï¼')
          else:
            print(f'Error: {response.status_code}')
            print(response.text)
            exit(1)
          "

      - name: Notify on failure
        if: failure()
        run: |
          python -c "
          import requests, json
          from datetime import datetime
          requests.post('${{ secrets.DISCORD_WEBHOOK_URL }}', json={
            'embeds': [{
              'title': 'âš ï¸ ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ã‚¨ãƒ©ãƒ¼',
              'description': 'ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚GitHub Actionsã®ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚',
              'color': 15158332,
              'timestamp': datetime.utcnow().isoformat()
            }]
          })
          "
